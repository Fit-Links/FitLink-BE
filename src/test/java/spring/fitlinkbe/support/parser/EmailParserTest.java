package spring.fitlinkbe.support.parser;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.assertNotNull;

class EmailParserTest {

    @Test
    @DisplayName("이메일 본문이 base64로 한번 더 인코딩 되어 있는 경우")
    void parseEmailContentEncoded() {
        String encodedContent = "UmV0dXJuLVBhdGg6IDwwMTA2Mjc4OTA0M0B2bW1zLm5hdGUuY29tPg0KUmVjZWl2ZWQ6IGZyb20gdm1tcy5uYXRlLmNvbSAoWzIxMS4xODguMTk3LjExMl0pDQogYnkgaW5ib3VuZC1zbXRwLmFwLW5vcnRoZWFzdC0yLmFtYXpvbmF3cy5jb20gd2l0aCBTTVRQIGlkIHRlN2E1MDVtc2ltNmdpMW43cWFxa2JiNDI3bzVrbmt" +
                "0bm1zaWM2MDENCiBmb3IgdmVyaWZpY2F0aW9uQGZpdGxpbmsuYml6Ow0KIFRodSwgMDEgTWF5IDIwMjUgMDg6NDg6MTEgKzAwMDAgKFVUQykNClgtU0VTLVNwYW0tVmVyZGljdDogUEFTUw0KWC1TRVMtVmlydXMtVmVyZGljdDogUEFTUw0KUmVjZWl2ZWQtU1BGOiBwYXNzIChzcGZDaGVjazogZG9tYWluIG9mIHZtbXMubmF0ZS5jb20gZGVzaWdu" +
                "YXRlcyAyMTEuMTg4LjE5Ny4xMTIgYXMgcGVybWl0dGVkIHNlbmRlcikgY2xpZW50LWlwPTIxMS4xODguMTk3LjExMjsgZW52ZWxvcGUtZnJvbT0wMTA2Mjc4OTA0M0B2bW1zLm5hdGUuY29tOyBoZWxvPXZtbXMubmF0ZS5jb207DQpBdXRoZW50aWNhdGlvbi1SZXN1bHRzOiBhbWF6b25zZXMuY29tOw0KIHNwZj1wYXNzIChzcGZDaGVjazogZG9tY" +
                "WluIG9mIHZtbXMubmF0ZS5jb20gZGVzaWduYXRlcyAyMTEuMTg4LjE5Ny4xMTIgYXMgcGVybWl0dGVkIHNlbmRlcikgY2xpZW50LWlwPTIxMS4xODguMTk3LjExMjsgZW52ZWxvcGUtZnJvbT0wMTA2Mjc4OTA0M0B2bW1zLm5hdGUuY29tOyBoZWxvPXZtbXMubmF0ZS5jb207DQogZG1hcmM9cGFzcyBoZWFkZXIuZnJvbT12bW1zLm5hdGUuY29tOw0" +
                "KWC1TRVMtUkVDRUlQVDogQUVGQlFVRkJRVUZCUVVGR2JVUjNUekpuYzNwUFZFNVdja1pZT0VsVVUzRktNMkpsU1dkbWN6SXJhM2hWUVhObWFWaFhkbHBwWW00MU0xaHZRMkZCSzBnMWVVTk1WVk5rY2t4U2JFRk1jbFZYUWxKaVNHdFJjaXRqTlU5WGFYbzNTSGx5Y0RSa1dIVkdVRXBTVDNGM2VqZHBaVkkxYVhFMFJWWndWVVY1VDFOcFpFODFWRE5PVV" +
                "U5b1IyeFRkbVJtTmxoS2VtaEZVV1F6Y0ZKaWEwZE1OMmd6VjNCUU1tWkRVVXRUV1dWV1ZEZGtaM3AzTDB4d1l6SkNiazVKY2tKb2NsWTJjVzkwVjJaRGFqZFdOVTFUTVdKQ1FrVlNTVUZUUlhabVFqWjVTa1oxZG1WaVExTndlRzUzZWtkdVlWaENUekJPTmxoWmNrbHBRM0oxZWxSbWF6RXhiMGgzVFhCeFkxcFVPSEJQSzBORlkxZGpkemRUY1V3d1VuQ" +
                "mFWV2xCTjBwaFIxVm1NRk14Y1ZWV2RuUXZjR0ZJVkRGVmEwRTlQUT09DQpYLVNFUy1ES0lNLVNJR05BVFVSRTogYT1yc2Etc2hhMjU2OyBxPWRucy90eHQ7IGI9RTJKSS9Xc0VveHNLWVRUem1zNnYwSFVtQ0Z5b1QwdjNTbmt1N1NvR3dUQ0N1UXhhN0ttUE5wWHdnMTlZS0g3Y3lsRTNqaHZ5TEJZTjgwVXF0NVROdVB3MU1sczFLQUg0c1hXTm9KU0hW" +
                "UjJqWHN4REhVbXVnSzMzVlp1a0dSUzVrdFNtb0pkKzROdlk3UVI5U0hSNy9iUXRCdzNGTThLMXNoTnBvR084THNvPTsgYz1yZWxheGVkL3NpbXBsZTsgcz1teXJ3cGduenYzcmY1amJzZGNreXc0a2F6bWJ2cXI0ZzsgZD1hbWF6b25zZXMuY29tOyB0PTE3NDYwODkyOTI7IHY9MTsgYmg9RlR4VFNiU0VSS2hpZW9pWXlRUiswMVhBdVlJZU0rTWl5bmR" +
                "mMDJPNFU4cz07IGg9RnJvbTpUbzpDYzpCY2M6U3ViamVjdDpEYXRlOk1lc3NhZ2UtSUQ6TUlNRS1WZXJzaW9uOkNvbnRlbnQtVHlwZTpYLVNFUy1SRUNFSVBUOw0KUmV0dXJuLVBhdGg6IDAxMDYyNzg5MDQzQHZtbXMubmF0ZS5jb20NCk1JTUUtVmVyc2lvbjogMS4wDQpGcm9tOiAiMDEwNjI3ODkwNDMiPDAxMDYyNzg5MDQzQHZtbXMubmF0ZS5jb2" +
                "0+DQpUbzogdmVyaWZpY2F0aW9uQGZpdGxpbmsuYml6DQpEYXRlOiBUaHUsIDAxIE1heSAyMDI1IDE3OjQ4OjExICswOTAwDQpTdWJqZWN0OiA9P1VURi04P0I/VzBacGRHeHBibXRkSUZWR1JRPT0/PQ0KWC1NbXMtTU1TLVZlcnNpb246IDMNClgtTW1zLVRyYW5zYWN0aW9uLUlEOiAwTW81MUE2TTUwMQ0KWC1NbXMtTWVzc2FnZS1DbGFzczogUGVyc2" +
                "9uYWwNClgtTW1zLUV4cGlyeTogVGh1IE1heSAyOSAxNzo0ODoxMSAyMDI1DQpYLU1tcy1EZWxpdmVyeS1UaW1lOiBUaHUgTWF5ICAxIDE3OjQ4OjExIDIwMjUNClgtTW1zLVByaW9yaXR5OiBOb3JtYWwNClgtTW1zLVNlbmRlci1WaXNpYmlsaXR5OiBTaG93DQpYLU1tcy1EZWxpdmVyeS1SZXBvcnQ6IE5vDQpYLU1tcy1SZWFkLVJlcGx5OiBObw0KQ2" +
                "9udGVudC1UeXBlOiBtdWx0aXBhcnQvbWl4ZWQ7IGJvdW5kYXJ5PSItLS0tLS0tU2tUZUxlQ29NX0luVGlDdUJlX05lV19NbVNfVmVSMTBfTW0zX01JWEVEIg0KDQoNCi0tLS0tLS0tLVNrVGVMZUNvTV9JblRpQ3VCZV9OZVdfTW1TX1ZlUjEwX01tM19NSVhFRA0KQ29udGVudC1UeXBlOiB0ZXh0L3BsYWluO2NoYXJzZXQ9IlVURi04Ig0KQ29udGVudC1" +
                "UcmFuc2Zlci1FbmNvZGluZzogYmFzZTY0DQoNClcwWnBkR3hwYm10ZENsVkdSVkp3ZEZwV1QzbDBiM3BtWWxKRFNYVkxZbmM9DQoNCi0tLS0tLS0tLVNrVGVMZUNvTV9JblRpQ3VCZV9OZVdfTW1TX1ZlUjEwX01tM19NSVhFRC0tDQoNCg==";

        String token = EmailParser.parseEmailContent(encodedContent);
        assertNotNull(token);
    }

    @Test
    @DisplayName("이메일 본문이 base64로 한번만 인코딩 되어 있는 경우")
    void parseEmailContent() {
        String encodedContent = "UmV0dXJuLVBhdGg6IDwwMTA5MDc5MDc5OEBrdGZtbXMubWFnaWNuLmNvbT4NClJlY2VpdmVkOiBmcm9tIGt0Zm1tcy5tYWdpY24uY29tIChbNjEuNzQuNjYuMTc2XSkNCiBieSBpbmJvdW5kLXNtdHAuYXAtbm9ydGhlYXN0LTIuYW1hem9uYXdzLmNvbSB3aXRoIFNNVFAgaWQgMDZycmNqdHR2M3RrdDQ0NDhsODlwbWprMXZuNDhnOWIyZW" +
                "JnZ2RnMQ0KIGZvciB2ZXJpZmljYXRpb25AZml0bGluay5iaXo7DQogVGh1LCAwMSBNYXkgMjAyNSAwNjo1NTozOSArMDAwMCAoVVRDKQ0KWC1TRVMtU3BhbS1WZXJkaWN0OiBQQVNTDQpYLVNFUy1WaXJ1cy1WZXJkaWN0OiBQQVNTDQpSZWNlaXZlZC1TUEY6IHBhc3MgKHNwZkNoZWNrOiBkb21haW4gb2Yga3RmbW1zLm1hZ2ljbi5jb20gZGVzaWduYXRlcyA2M" +
                "S43NC42Ni4xNzYgYXMgcGVybWl0dGVkIHNlbmRlcikgY2xpZW50LWlwPTYxLjc0LjY2LjE3NjsgZW52ZWxvcGUtZnJvbT0wMTA5MDc5MDc5OEBrdGZtbXMubWFnaWNuLmNvbTsgaGVsbz1rdGZtbXMubWFnaWNuLmNvbTsNCkF1dGhlbnRpY2F0aW9uLVJlc3VsdHM6IGFtYXpvbnNlcy5jb207DQogc3BmPXBhc3MgKHNwZkNoZWNrOiBkb21haW4gb2Yga3RmbW1zL" +
                "m1hZ2ljbi5jb20gZGVzaWduYXRlcyA2MS43NC42Ni4xNzYgYXMgcGVybWl0dGVkIHNlbmRlcikgY2xpZW50LWlwPTYxLjc0LjY2LjE3NjsgZW52ZWxvcGUtZnJvbT0wMTA5MDc5MDc5OEBrdGZtbXMubWFnaWNuLmNvbTsgaGVsbz1rdGZtbXMubWFnaWNuLmNvbTsNCiBkbWFyYz1ub25lIGhlYWRlci5mcm9tPWt0Zm1tcy5tYWdpY24uY29tOw0KWC1TRVMtUkVDRU" +
                "lQVDogQUVGQlFVRkJRVUZCUVVGSFlqbGpWbEZWY1RsdE1GZEJiMmh0VVhwM1FVWkphekl2U1VkbU9ITktabWxVVjJoUllWRjNZMnA0WTB4MVR6TlFUbEpHVnlzMVJIbzFhV1JQVDA0cmFHNVJLMVZTZFZWcFJGa3lkSFk1WjFKWkx6QnBTVmx3WTJKR2MwUjZZblZOY1d3NGJFZDJPVE5DYUhocU4xUjVaRGRNT1VGaE5FbE5OM0Y1VFdJeVRYRlVWM1J1WTFreVR6RTF" +
                "RalptTDJscFEyMTZNRlpJVDJrM2NVaFdiSG81TjFCRlEyRmhRMVowVW1KYVlpOXhiV1YxTDNCNlExQjNNa2RGU0UweFExbHVLMnRxZFdFMlpIcHNjWEF2TTFWYVp6QTJSbVp4Ym1saE5IRmFRbmx2VWxOcmFXRXlLMEp2WVd4WFZrMW1ORXhvYm5kMlFuUlFiSGR3ZFc5QmVVVkJjMnh0V0dJNWRHcEZUR1JYZFVzNWFHeDFNemhtUVZvdmRUaHdkazk2YTB0amJFOXhU" +
                "REI1Y1djdlRVRTlQUT09DQpYLVNFUy1ES0lNLVNJR05BVFVSRTogYT1yc2Etc2hhMjU2OyBxPWRucy90eHQ7IGI9dWdZWEtUUTNBYy9VQkx6b0RmSGh5QlpuOHdHakh5UWdzMDdsL3BhVERJK1RneElDTE5TSkcxbkNRLzJFZS9BVU41RlVUOFVydTdSL0V5eGdQcDUvYkViZHdQWXArbU9vUDBJY09FQmJEcDd3ZXV2bWZzU1luKzBuZGRhaEx3ZUFTRlVNUGtjczdFdz" +
                "hWdG5TK0xQRUMvZk1yM2g5clBnM3ZNN21lQnA0ZjJzPTsgYz1yZWxheGVkL3NpbXBsZTsgcz1teXJ3cGduenYzcmY1amJzZGNreXc0a2F6bWJ2cXI0ZzsgZD1hbWF6b25zZXMuY29tOyB0PTE3NDYwODI1NDA7IHY9MTsgYmg9bEhkSlc2L0ZUTUZucXExeU0zNVNrZFZRWUF5Mkd0VHF2Y3puV0U3OWRNTT07IGg9RnJvbTpUbzpDYzpCY2M6U3ViamVjdDpEYXRlOk1l" +
                "c3NhZ2UtSUQ6TUlNRS1WZXJzaW9uOkNvbnRlbnQtVHlwZTpYLVNFUy1SRUNFSVBUOw0KRGF0ZTogVGh1LCAwMSBNYXkgMjAyNSAxNTo1NTozMyArMDkwMCAoS1NUKQ0KRnJvbTogIjAxMDkwNzkwNzk4IDy5373FwPy/6z4iIDwwMTA5MDc5MDc5OEBrdGZtbXMubWFnaWNuLmNvbT4NClRvOiA8dmVyaWZpY2F0aW9uQGZpdGxpbmsuYml6Pg0KTWVzc2FnZS1JRDogP" +
                "EEyMDI1MDUwMTE1NTUzMzM1MDE1MDFMNT4NCkNvbnRlbnQtVHlwZTogbXVsdGlwYXJ0L21peGVkOwlib3VuZGFyeT0ia1RmTG1TOjpiT3VOZEFyWTo6dEVzVDoxMTI4OTczNTk4a3NkamZoc2RrIg0KU3ViamVjdDogwaa48b74wL0NCk1JTUUtVmVyc2lvbjogMS4wDQoNCi0ta1RmTG1TOjpiT3VOZEFyWTo6dEVzVDoxMTI4OTczNTk4a3NkamZoc2RrDQpDb250ZW5" +
                "0LVR5cGU6IHRleHQvcGxhaW47IGNoYXJzZXQ9ImV1Yy1rciI7IG5hbWU9InRleHRfMC50eHQiDQpDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiA4Yml0DQoNCltmaXRdCmR0UWV4dGFGWlJoWW5nQjRWdFpGT0EKDQoNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KursguN7Az8C6IMjetOvG+b+hvK0gud" +
                "+9xbXHvu4gyLi9xSC60rChx9EguN7Az8DUtM+02S4NCrnfvcUgwda80sDHILn4yKOwoSC5373FIMjetOvG+cDHIMD8yK25+MijwNS0z7TZLg0KursguN7Az8C6ILnfvcUgwPy/67jewM/AzLjnIMi4vcW1x8H2IL7KvcC0z7TZLg0KyLi9xcC7IL/4x8+9xyCw5r/sIFNNU7OqICBNTVO4piDAzL/rx8+9w7HiILnZtvi0z7TZLg0KPT09PT09PT09PT09PT09PT09PT09P" +
                "T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoNCi0ta1RmTG1TOjpiT3VOZEFyWTo6dEVzVDoxMTI4OTczNTk4a3NkamZoc2RrLS0NCg0KDQo=";

        String token = EmailParser.parseEmailContent(encodedContent);
        assertNotNull(token);
    }
}
