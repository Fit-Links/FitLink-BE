package spring.fitlinkbe.support.parser;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.assertNotNull;

class EmailParserTest {

    @Test
    @DisplayName("이메일 본문이 base64로 한번 더 인코딩 되어 있는 경우")
    void parseEmailContentEncoded() {
        String encodedContent = "UmV0dXJuLVBhdGg6IDwwMTA2Mjc4OTA0M0B2bW1zLm5hdGUuY29tPg0KUmVjZWl2ZWQ6IGZyb20gdm1tcy5uYXRlLmNvbSAoWzIxMS4xODguMTk3LjExMl0pDQogYnkgaW5ib3VuZC1zbXRwLmFwLW5vcnRoZWFzdC0yLmFtYXpvbmF3cy5jb20gd2l0aCBTTVRQIGlkIHRlN2E1MDVtc2ltNmdpMW43cWFxa2JiNDI3bzVrbmt0bm1zaWM2MDENCiBmb3IgdmVyaWZpY2F0aW9uQGZpdGxpbmsuYml6Ow0KIFRodSwgMDEgTWF5IDIwMjUgMDg6NDg6MTEgKzAwMDAgKFVUQykNClgtU0VTLVNwYW0tVmVyZGljdDogUEFTUw0KWC1TRVMtVmlydXMtVmVyZGljdDogUEFTUw0KUmVjZWl2ZWQtU1BGOiBwYXNzIChzcGZDaGVjazogZG9tYWluIG9mIHZtbXMubmF0ZS5jb20gZGVzaWduYXRlcyAyMTEuMTg4LjE5Ny4xMTIgYXMgcGVybWl0dGVkIHNlbmRlcikgY2xpZW50LWlwPTIxMS4xODguMTk3LjExMjsgZW52ZWxvcGUtZnJvbT0wMTA2Mjc4OTA0M0B2bW1zLm5hdGUuY29tOyBoZWxvPXZtbXMubmF0ZS5jb207DQpBdXRoZW50aWNhdGlvbi1SZXN1bHRzOiBhbWF6b25zZXMuY29tOw0KIHNwZj1wYXNzIChzcGZDaGVjazogZG9tYWluIG9mIHZtbXMubmF0ZS5jb20gZGVzaWduYXRlcyAyMTEuMTg4LjE5Ny4xMTIgYXMgcGVybWl0dGVkIHNlbmRlcikgY2xpZW50LWlwPTIxMS4xODguMTk3LjExMjsgZW52ZWxvcGUtZnJvbT0wMTA2Mjc4OTA0M0B2bW1zLm5hdGUuY29tOyBoZWxvPXZtbXMubmF0ZS5jb207DQogZG1hcmM9cGFzcyBoZWFkZXIuZnJvbT12bW1zLm5hdGUuY29tOw0KWC1TRVMtUkVDRUlQVDogQUVGQlFVRkJRVUZCUVVGR2JVUjNUekpuYzNwUFZFNVdja1pZT0VsVVUzRktNMkpsU1dkbWN6SXJhM2hWUVhObWFWaFhkbHBwWW00MU0xaHZRMkZCSzBnMWVVTk1WVk5rY2t4U2JFRk1jbFZYUWxKaVNHdFJjaXRqTlU5WGFYbzNTSGx5Y0RSa1dIVkdVRXBTVDNGM2VqZHBaVkkxYVhFMFJWWndWVVY1VDFOcFpFODFWRE5PVVU5b1IyeFRkbVJtTmxoS2VtaEZVV1F6Y0ZKaWEwZE1OMmd6VjNCUU1tWkRVVXRUV1dWV1ZEZGtaM3AzTDB4d1l6SkNiazVKY2tKb2NsWTJjVzkwVjJaRGFqZFdOVTFUTVdKQ1FrVlNTVUZUUlhabVFqWjVTa1oxZG1WaVExTndlRzUzZWtkdVlWaENUekJPTmxoWmNrbHBRM0oxZWxSbWF6RXhiMGgzVFhCeFkxcFVPSEJQSzBORlkxZGpkemRUY1V3d1VuQmFWV2xCTjBwaFIxVm1NRk14Y1ZWV2RuUXZjR0ZJVkRGVmEwRTlQUT09DQpYLVNFUy1ES0lNLVNJR05BVFVSRTogYT1yc2Etc2hhMjU2OyBxPWRucy90eHQ7IGI9RTJKSS9Xc0VveHNLWVRUem1zNnYwSFVtQ0Z5b1QwdjNTbmt1N1NvR3dUQ0N1UXhhN0ttUE5wWHdnMTlZS0g3Y3lsRTNqaHZ5TEJZTjgwVXF0NVROdVB3MU1sczFLQUg0c1hXTm9KU0hWUjJqWHN4REhVbXVnSzMzVlp1a0dSUzVrdFNtb0pkKzROdlk3UVI5U0hSNy9iUXRCdzNGTThLMXNoTnBvR084THNvPTsgYz1yZWxheGVkL3NpbXBsZTsgcz1teXJ3cGduenYzcmY1amJzZGNreXc0a2F6bWJ2cXI0ZzsgZD1hbWF6b25zZXMuY29tOyB0PTE3NDYwODkyOTI7IHY9MTsgYmg9RlR4VFNiU0VSS2hpZW9pWXlRUiswMVhBdVlJZU0rTWl5bmRmMDJPNFU4cz07IGg9RnJvbTpUbzpDYzpCY2M6U3ViamVjdDpEYXRlOk1lc3NhZ2UtSUQ6TUlNRS1WZXJzaW9uOkNvbnRlbnQtVHlwZTpYLVNFUy1SRUNFSVBUOw0KUmV0dXJuLVBhdGg6IDAxMDYyNzg5MDQzQHZtbXMubmF0ZS5jb20NCk1JTUUtVmVyc2lvbjogMS4wDQpGcm9tOiAiMDEwNjI3ODkwNDMiPDAxMDYyNzg5MDQzQHZtbXMubmF0ZS5jb20+DQpUbzogdmVyaWZpY2F0aW9uQGZpdGxpbmsuYml6DQpEYXRlOiBUaHUsIDAxIE1heSAyMDI1IDE3OjQ4OjExICswOTAwDQpTdWJqZWN0OiA9P1VURi04P0I/VzBacGRHeHBibXRkSUZWR1JRPT0/PQ0KWC1NbXMtTU1TLVZlcnNpb246IDMNClgtTW1zLVRyYW5zYWN0aW9uLUlEOiAwTW81MUE2TTUwMQ0KWC1NbXMtTWVzc2FnZS1DbGFzczogUGVyc29uYWwNClgtTW1zLUV4cGlyeTogVGh1IE1heSAyOSAxNzo0ODoxMSAyMDI1DQpYLU1tcy1EZWxpdmVyeS1UaW1lOiBUaHUgTWF5ICAxIDE3OjQ4OjExIDIwMjUNClgtTW1zLVByaW9yaXR5OiBOb3JtYWwNClgtTW1zLVNlbmRlci1WaXNpYmlsaXR5OiBTaG93DQpYLU1tcy1EZWxpdmVyeS1SZXBvcnQ6IE5vDQpYLU1tcy1SZWFkLVJlcGx5OiBObw0KQ29udGVudC1UeXBlOiBtdWx0aXBhcnQvbWl4ZWQ7IGJvdW5kYXJ5PSItLS0tLS0tU2tUZUxlQ29NX0luVGlDdUJlX05lV19NbVNfVmVSMTBfTW0zX01JWEVEIg0KDQoNCi0tLS0tLS0tLVNrVGVMZUNvTV9JblRpQ3VCZV9OZVdfTW1TX1ZlUjEwX01tM19NSVhFRA0KQ29udGVudC1UeXBlOiB0ZXh0L3BsYWluO2NoYXJzZXQ9IlVURi04Ig0KQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZzogYmFzZTY0DQoNClcwWnBkR3hwYm10ZENsVkdSVkp3ZEZwV1QzbDBiM3BtWWxKRFNYVkxZbmM9DQoNCi0tLS0tLS0tLVNrVGVMZUNvTV9JblRpQ3VCZV9OZVdfTW1TX1ZlUjEwX01tM19NSVhFRC0tDQoNCg==";

        String token = EmailParser.parseEmailContent(encodedContent);
        assertNotNull(token);
    }


    @Test
    @DisplayName("이메일 본문이 base64로 한번 더 인코딩 되어 있는 경우 v2")
    void parseEmailContent2() {
        String encodedContent = "UmV0dXJuLVBhdGg6IDwwMTA0MDU4MTQ5MkBtbXNtYWlsLnVwbHVzLmNvLmtyPg0KUmVjZWl2ZWQ6IGZyb20gbW1zbWFpbC51cGx1cy5jby5rciAobW1zbWFpbC51cGx1cy5jby5rciBbMTA2LjEwMy4yMDQuMTE1XSkNCiBieSBpbmJvdW5kLXNtdHAuYXAtbm9ydGhlYXN0LTIuYW1hem9uYXdzLmNvbSB3aXRoIFNNVFAgaWQgczBvZ3I1Y3E2bmpucGphNjEwNW9rY2F0NWY1NjBpcGs0MmRnOGVnMQ0KIGZvciB2ZXJpZmljYXRpb25AZml0bGluay5iaXo7DQogVHVlLCAwNiBNYXkgMjAyNSAwODoyNjoyMyArMDAwMCAoVVRDKQ0KWC1TRVMtU3BhbS1WZXJkaWN0OiBQQVNTDQpYLVNFUy1WaXJ1cy1WZXJkaWN0OiBQQVNTDQpSZWNlaXZlZC1TUEY6IHBhc3MgKHNwZkNoZWNrOiBkb21haW4gb2YgbW1zbWFpbC51cGx1cy5jby5rciBkZXNpZ25hdGVzIDEwNi4xMDMuMjA0LjExNSBhcyBwZXJtaXR0ZWQgc2VuZGVyKSBjbGllbnQtaXA9MTA2LjEwMy4yMDQuMTE1OyBlbnZlbG9wZS1mcm9tPTAxMDQwNTgxNDkyQG1tc21haWwudXBsdXMuY28ua3I7IGhlbG89bW1zbWFpbC51cGx1cy5jby5rcjsNCkF1dGhlbnRpY2F0aW9uLVJlc3VsdHM6IGFtYXpvbnNlcy5jb207DQogc3BmPXBhc3MgKHNwZkNoZWNrOiBkb21haW4gb2YgbW1zbWFpbC51cGx1cy5jby5rciBkZXNpZ25hdGVzIDEwNi4xMDMuMjA0LjExNSBhcyBwZXJtaXR0ZWQgc2VuZGVyKSBjbGllbnQtaXA9MTA2LjEwMy4yMDQuMTE1OyBlbnZlbG9wZS1mcm9tPTAxMDQwNTgxNDkyQG1tc21haWwudXBsdXMuY28ua3I7IGhlbG89bW1zbWFpbC51cGx1cy5jby5rcjsNCiBkbWFyYz1wYXNzIGhlYWRlci5mcm9tPW1tc21haWwudXBsdXMuY28ua3I7DQpYLVNFUy1SRUNFSVBUOiBBRUZCUVVGQlFVRkJRVUZIY0dRM1ZGVmxMM2xXYjFnM2FHbDJhVWx6YzJ4UGNtNURVMnhMZVUxRVNGVmtkMkp3U1RSVWVsTk5VRU5RZGxkVmREaFRhVzR3YjBST1YzUlhXVGxwT0VSVE5uRTRUMFI0ZUc1c1IyZDNMM3BOZERWV04wb3llVmswZVRjeVlWbFRTVTlWZUVWNVJHdDFXa3h4UW05MldHZDNhWGwwWlVWWmFFdG1jRmx4V1hZcmNqWm5ha2t5SzFCV01YbFhjak5GYlRGcFpVSktSbWhWZWtVMU5FbDZOelpqWWs5cWNtTjRRbklyUWk5blUwbFNOM1ZRVFM5TVlraGFaamRhTWpNcmJWSmFZMUk1UmxwRU9Yb3lPRzlMTW1jeFJuYzBRVVJ4VTNkVmMwUTRRMHhxT1VKblZEZHROWGc1TkZGVlFWUnBUaTh3TlZOQ1VpdGtTakJXVmxKMFRGRkNhR3hDWVdGMk1VeGFRamhsYmxwWE5FNU9ObmxhV1ZwT1MydE5NSEYxVFZVeFV6VlVWUzlHVG1kNlRrbFFRVlp0VDNSSFZWbDBVV3BGYTBWamIyczkNClgtU0VTLURLSU0tU0lHTkFUVVJFOiBhPXJzYS1zaGEyNTY7IHE9ZG5zL3R4dDsgYj1sZ3F5Q3lESmszbzM1d3d1bktVU2c1YmdVUGdvK1pRODYyRXBvMFZXbnlWcUJtODZWbU1tYVRMTmhKNU50eXZVZ01nRE5aU0NrUnp1TWs2U0d4NGdHNkt1bTQxMEI4QWJKb0lma2FGeHlLL3hBaytGNjE5bysrRk1ZbkpZb0JnczBGeDdtVCtWWWE3TExMYkxqdnFDNG44eVdEK0lMTExqaGhzeHRrVWVYRE09OyBjPXJlbGF4ZWQvc2ltcGxlOyBzPW15cndwZ256djNyZjVqYnNkY2t5dzRrYXptYnZxcjRnOyBkPWFtYXpvbnNlcy5jb207IHQ9MTc0NjUxOTk4Mzsgdj0xOyBiaD1kRXlxTzVqalpDbktDakhhT3liM0U3SitMMWlyZjZZMEZhZlQ2dWo5M0M4PTsgaD1Gcm9tOlRvOkNjOkJjYzpTdWJqZWN0OkRhdGU6TWVzc2FnZS1JRDpNSU1FLVZlcnNpb246Q29udGVudC1UeXBlOlgtU0VTLVJFQ0VJUFQ7DQpEYXRlOiBUdWUsIDA2IE1heSAyMDI1IDE3OjI2OjIzICswOTAwIChLU1QpDQpGcm9tOiAwMTA0MDU4MTQ5MkBtbXNtYWlsLnVwbHVzLmNvLmtyDQpUbzp2ZXJpZmljYXRpb25AZml0bGluay5iaXoNCk1lc3NhZ2UtSUQ6IDwyMDI1MDUwNjE3MjYyMy4wMjguWUdmYmlwaEtuZkBtbXNtYWlsLnVwbHVzLmNvLmtyPg0KU3ViamVjdDogPT9VVEYtOD9CP1creWduT3VxcWV5WGh1eWRqRjA9Pz0NCk1JTUUtVmVyc2lvbjogMS4wDQpDb250ZW50LVR5cGU6IG11bHRpcGFydC9taXhlZDsgYm91bmRhcnk9Ii0tLS09X1BhcnRfMjA1MDM5XzIwODQ2NDk3MDkuMTc0NjUxOTk4Mjk4NiINCg0KLS0tLS0tPV9QYXJ0XzIwNTAzOV8yMDg0NjQ5NzA5LjE3NDY1MTk5ODI5ODYNCkNvbnRlbnQtVHJhbnNmZXItRW5jb2Rpbmc6IGJhc2U2NA0KQ29udGVudC1UeXBlOiB0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04DQoNClcyWnBkR3hwYm10ZENuVnhkVGR5YjNoNE1taDVNbmRuYkMxcGNXd3RObmNOQ2cwS1BUMDlQVDA5UFQwOVBUMDlQVDA5SUNCTVJ5QlZLDQp5RHJxcWpyc0pUc25id2dJRDA5UFQwOVBUMDlQVDA5UFQwOVBUMDlQVDBLN1p5MDY0eUE3WSt3N0plUTdJU2NJT3V3bk95TG9PdVFuQw0KRHJxWlRzbmJ6c25vWHJpNGpyaTZRdUN1dXp1Q0RycVpUc25ienNuWUFnNjdDYzdJdWdJT3lnaE95YXFTRHJxWlRzbmJ6cm9ad3NJTzINCmFqT3lMb095ZHRDRHJ0b2pxc0lEcmlxWHRsYW5yaTRqcmk2UXVDajA5UFQwOVBUMDlQVDA5UFQwOVBUMDlQVDA5UFQwOVBUMDlQVDA5DQpQVDA5UFQwOVBUMDlQVDA5UFQwOVBUMDlQVDA5Q2c9PQ0KDQotLS0tLS09X1BhcnRfMjA1MDM5XzIwODQ2NDk3MDkuMTc0NjUxOTk4Mjk4Ni0tDQo=";

        String token = EmailParser.parseEmailContent(encodedContent);
        assertNotNull(token);
    }

    @Test
    @DisplayName("이메일 본문이 base64로 한번만 인코딩 되어 있는 경우")
    void parseEmailContent() {
        String encodedContent = "UmV0dXJuLVBhdGg6IDwwMTA5MDc5MDc5OEBrdGZtbXMubWFnaWNuLmNvbT4NClJlY2VpdmVkOiBmcm9tIGt0Zm1tcy5tYWdpY24uY29tIChbNjEuNzQuNjYuMTc2XSkNCiBieSBpbmJvdW5kLXNtdHAuYXAtbm9ydGhlYXN0LTIuYW1hem9uYXdzLmNvbSB3aXRoIFNNVFAgaWQgMDZycmNqdHR2M3RrdDQ0NDhsODlwbWprMXZuNDhnOWIyZWJnZ2RnMQ0KIGZvciB2ZXJpZmljYXRpb25AZml0bGluay5iaXo7DQogVGh1LCAwMSBNYXkgMjAyNSAwNjo1NTozOSArMDAwMCAoVVRDKQ0KWC1TRVMtU3BhbS1WZXJkaWN0OiBQQVNTDQpYLVNFUy1WaXJ1cy1WZXJkaWN0OiBQQVNTDQpSZWNlaXZlZC1TUEY6IHBhc3MgKHNwZkNoZWNrOiBkb21haW4gb2Yga3RmbW1zLm1hZ2ljbi5jb20gZGVzaWduYXRlcyA2MS43NC42Ni4xNzYgYXMgcGVybWl0dGVkIHNlbmRlcikgY2xpZW50LWlwPTYxLjc0LjY2LjE3NjsgZW52ZWxvcGUtZnJvbT0wMTA5MDc5MDc5OEBrdGZtbXMubWFnaWNuLmNvbTsgaGVsbz1rdGZtbXMubWFnaWNuLmNvbTsNCkF1dGhlbnRpY2F0aW9uLVJlc3VsdHM6IGFtYXpvbnNlcy5jb207DQogc3BmPXBhc3MgKHNwZkNoZWNrOiBkb21haW4gb2Yga3RmbW1zLm1hZ2ljbi5jb20gZGVzaWduYXRlcyA2MS43NC42Ni4xNzYgYXMgcGVybWl0dGVkIHNlbmRlcikgY2xpZW50LWlwPTYxLjc0LjY2LjE3NjsgZW52ZWxvcGUtZnJvbT0wMTA5MDc5MDc5OEBrdGZtbXMubWFnaWNuLmNvbTsgaGVsbz1rdGZtbXMubWFnaWNuLmNvbTsNCiBkbWFyYz1ub25lIGhlYWRlci5mcm9tPWt0Zm1tcy5tYWdpY24uY29tOw0KWC1TRVMtUkVDRUlQVDogQUVGQlFVRkJRVUZCUVVGSFlqbGpWbEZWY1RsdE1GZEJiMmh0VVhwM1FVWkphekl2U1VkbU9ITktabWxVVjJoUllWRjNZMnA0WTB4MVR6TlFUbEpHVnlzMVJIbzFhV1JQVDA0cmFHNVJLMVZTZFZWcFJGa3lkSFk1WjFKWkx6QnBTVmx3WTJKR2MwUjZZblZOY1d3NGJFZDJPVE5DYUhocU4xUjVaRGRNT1VGaE5FbE5OM0Y1VFdJeVRYRlVWM1J1WTFreVR6RTFRalptTDJscFEyMTZNRlpJVDJrM2NVaFdiSG81TjFCRlEyRmhRMVowVW1KYVlpOXhiV1YxTDNCNlExQjNNa2RGU0UweFExbHVLMnRxZFdFMlpIcHNjWEF2TTFWYVp6QTJSbVp4Ym1saE5IRmFRbmx2VWxOcmFXRXlLMEp2WVd4WFZrMW1ORXhvYm5kMlFuUlFiSGR3ZFc5QmVVVkJjMnh0V0dJNWRHcEZUR1JYZFVzNWFHeDFNemhtUVZvdmRUaHdkazk2YTB0amJFOXhUREI1Y1djdlRVRTlQUT09DQpYLVNFUy1ES0lNLVNJR05BVFVSRTogYT1yc2Etc2hhMjU2OyBxPWRucy90eHQ7IGI9dWdZWEtUUTNBYy9VQkx6b0RmSGh5QlpuOHdHakh5UWdzMDdsL3BhVERJK1RneElDTE5TSkcxbkNRLzJFZS9BVU41RlVUOFVydTdSL0V5eGdQcDUvYkViZHdQWXArbU9vUDBJY09FQmJEcDd3ZXV2bWZzU1luKzBuZGRhaEx3ZUFTRlVNUGtjczdFdzhWdG5TK0xQRUMvZk1yM2g5clBnM3ZNN21lQnA0ZjJzPTsgYz1yZWxheGVkL3NpbXBsZTsgcz1teXJ3cGduenYzcmY1amJzZGNreXc0a2F6bWJ2cXI0ZzsgZD1hbWF6b25zZXMuY29tOyB0PTE3NDYwODI1NDA7IHY9MTsgYmg9bEhkSlc2L0ZUTUZucXExeU0zNVNrZFZRWUF5Mkd0VHF2Y3puV0U3OWRNTT07IGg9RnJvbTpUbzpDYzpCY2M6U3ViamVjdDpEYXRlOk1lc3NhZ2UtSUQ6TUlNRS1WZXJzaW9uOkNvbnRlbnQtVHlwZTpYLVNFUy1SRUNFSVBUOw0KRGF0ZTogVGh1LCAwMSBNYXkgMjAyNSAxNTo1NTozMyArMDkwMCAoS1NUKQ0KRnJvbTogIjAxMDkwNzkwNzk4IDy5373FwPy/6z4iIDwwMTA5MDc5MDc5OEBrdGZtbXMubWFnaWNuLmNvbT4NClRvOiA8dmVyaWZpY2F0aW9uQGZpdGxpbmsuYml6Pg0KTWVzc2FnZS1JRDogPEEyMDI1MDUwMTE1NTUzMzM1MDE1MDFMNT4NCkNvbnRlbnQtVHlwZTogbXVsdGlwYXJ0L21peGVkOwlib3VuZGFyeT0ia1RmTG1TOjpiT3VOZEFyWTo6dEVzVDoxMTI4OTczNTk4a3NkamZoc2RrIg0KU3ViamVjdDogwaa48b74wL0NCk1JTUUtVmVyc2lvbjogMS4wDQoNCi0ta1RmTG1TOjpiT3VOZEFyWTo6dEVzVDoxMTI4OTczNTk4a3NkamZoc2RrDQpDb250ZW50LVR5cGU6IHRleHQvcGxhaW47IGNoYXJzZXQ9ImV1Yy1rciI7IG5hbWU9InRleHRfMC50eHQiDQpDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiA4Yml0DQoNCltmaXRdCmR0UWV4dGFGWlJoWW5nQjRWdFpGT0EKDQoNCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KursguN7Az8C6IMjetOvG+b+hvK0gud+9xbXHvu4gyLi9xSC60rChx9EguN7Az8DUtM+02S4NCrnfvcUgwda80sDHILn4yKOwoSC5373FIMjetOvG+cDHIMD8yK25+MijwNS0z7TZLg0KursguN7Az8C6ILnfvcUgwPy/67jewM/AzLjnIMi4vcW1x8H2IL7KvcC0z7TZLg0KyLi9xcC7IL/4x8+9xyCw5r/sIFNNU7OqICBNTVO4piDAzL/rx8+9w7HiILnZtvi0z7TZLg0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQoNCi0ta1RmTG1TOjpiT3VOZEFyWTo6dEVzVDoxMTI4OTczNTk4a3NkamZoc2RrLS0NCg0KDQo=";

        String token = EmailParser.parseEmailContent(encodedContent);
        assertNotNull(token);
    }

}
